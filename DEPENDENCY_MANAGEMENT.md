# ä¾èµ–å’Œç‰ˆæœ¬ç®¡ç†æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**ç”Ÿæˆæ—¥æœŸ**: 2025å¹´11æœˆ17æ—¥  

---

## ğŸ“‹ ç›®å½•

1. [Engines å­—æ®µé…ç½®](#engines-å­—æ®µé…ç½®)
2. [ä¾èµ–åˆ†ç±»](#ä¾èµ–åˆ†ç±»)
3. [å‡çº§æµç¨‹](#å‡çº§æµç¨‹)
4. [å®‰å…¨æ‰«æ](#å®‰å…¨æ‰«æ)
5. [æ•°æ®åº“å…¼å®¹æ€§](#æ•°æ®åº“å…¼å®¹æ€§)
6. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸ”§ Engines å­—æ®µé…ç½®

### ä¸ºä»€ä¹ˆéœ€è¦ engines å­—æ®µï¼Ÿ

`engines` å­—æ®µåœ¨ `package.json` ä¸­æ–‡æ¡£åŒ–äº†å›¢é˜Ÿæ ‡å‡†å’Œé¡¹ç›®è¦æ±‚çš„æœ€å°ç¯å¢ƒç‰ˆæœ¬ï¼š

```json
{
  "engines": {
    "node": "18.x",
    "npm": "10.x"
  }
}
```

### å½“å‰é…ç½®

**é¡¹ç›®**: ç‰›ç‰›æ£‹ç‰ŒæœåŠ¡å™¨  
**Node.js**: 18.x (LTS - é•¿æœŸæ”¯æŒ)  
**npm**: 10.x  

### ç‰ˆæœ¬é€‰æ‹©åŸå› 

| ç»„ä»¶ | ç‰ˆæœ¬ | åŸå›  |
|------|------|------|
| Node.js | 18.x | LTS ç‰ˆæœ¬ï¼Œæ”¯æŒåˆ° 2025 å¹´ 4 æœˆï¼Œäº§çº¿ç¨³å®šï¼Œnpm 10.x å…¼å®¹ |
| npm | 10.x | æ”¯æŒæ›´å¥½çš„ä¾èµ–è§£æï¼Œå®‰å…¨å®¡è®¡åŠŸèƒ½å®Œæ•´ |

### éªŒè¯ç¯å¢ƒå…¼å®¹æ€§

```bash
# æ£€æŸ¥æœ¬åœ°ç¯å¢ƒæ˜¯å¦æ»¡è¶³è¦æ±‚
npm ls --engines

# é¢„æœŸè¾“å‡º:
# npm WARN engines
# npm WARN engines niuniu_server@1.0.0: wanted: {"node":"18.x","npm":"10.x"}
# npm WARN engines niuniu_server@1.0.0: current: {"node":"18.20.8","npm":"10.8.0"}

# åœ¨ CI/CD ä¸­å¼ºåˆ¶æ£€æŸ¥
if ! npm ls --engines > /dev/null 2>&1; then
    echo "âŒ ç¯å¢ƒä¸æ»¡è¶³ engines è¦æ±‚"
    exit 1
fi
```

### æ›´æ–° engines å­—æ®µ

å½“éœ€è¦å‡çº§æœ€å°ç¯å¢ƒç‰ˆæœ¬æ—¶ï¼ˆä¾‹å¦‚è¿ç§»åˆ° Node 20ï¼‰ï¼š

```json
// æ—§é…ç½®
{
  "engines": {
    "node": "18.x",
    "npm": "10.x"
  }
}

// æ–°é…ç½®ï¼ˆè®¡åˆ’è¿ç§»ï¼‰
{
  "engines": {
    "node": "20.x",      // LTSï¼Œæ›´æ–°çš„ V8 å¼•æ“
    "npm": "10.x"        // ä¿æŒä¸å˜
  }
}

// è¿ç§»æ­¥éª¤:
// 1. åœ¨æœ¬åœ°å‡çº§åˆ° Node 20
// 2. è¿è¡Œå®Œæ•´æµ‹è¯•
// 3. æ›´æ–° engines å­—æ®µ
// 4. æ›´æ–° .nvmrc æ–‡ä»¶
// 5. æäº¤ PR
// 6. CI/CD è¿è¡ŒéªŒè¯
// 7. ç°åº¦éƒ¨ç½²æ–°ç¯å¢ƒ
```

---

## ğŸ“¦ ä¾èµ–åˆ†ç±»

### æ ¸å¿ƒä¾èµ–ï¼ˆç”Ÿäº§ï¼‰

è¿™äº›ä¾èµ–ç›´æ¥å½±å“åº”ç”¨çš„åŠŸèƒ½å’Œæ€§èƒ½ï¼Œ**å¿…é¡»è°¨æ…ç®¡ç†**ã€‚

#### ç½‘ç»œé€šä¿¡å±‚

| åŒ… | å½“å‰ç‰ˆæœ¬ | ä½œç”¨ | å‡çº§ç­–ç•¥ | çŠ¶æ€ |
|----|---------| ----|--------|------|
| `express` | ^4.21.2 | HTTP æ¡†æ¶ | ä»… patch æ›´æ–° | âœ… ç¨³å®š |
| `ws` | ^8.18.0 | WebSocket åº“ | ä»… patch æ›´æ–° | âœ… ç¨³å®š |
| `request` | ^2.88.2 | HTTP å®¢æˆ·ç«¯ | âš ï¸ å®˜æ–¹å¼ƒç”¨ï¼Œè®¡åˆ’è¿ç§»åˆ° axios | âš ï¸ éœ€è¿ç§» |

**å‡çº§è®¡åˆ’**:
```bash
# 1. Express patch æ›´æ–°
npm install express@^4.21.3  # å®‰å…¨å’Œæ€§èƒ½è¡¥ä¸
npm test && npm run lint     # éªŒè¯

# 2. WS æ›´æ–°
npm install ws@^8.18.1       # WebSocket ä¿®å¤

# 3. Request è¿ç§»ï¼ˆé•¿æœŸé¡¹ç›®ï¼‰
npm install axios@^1.6.0     # æ–°ä¾èµ–
# é€æ­¥æ›¿æ¢æ‰€æœ‰ request è°ƒç”¨
npm uninstall request        # æœ€ååˆ é™¤æ—§ä¾èµ–
```

#### æ•°æ®å­˜å‚¨å±‚

| åŒ… | å½“å‰ç‰ˆæœ¬ | ä½œç”¨ | å‡çº§ç­–ç•¥ | çŠ¶æ€ |
|----|---------| ----|--------|------|
| `mysql` | ^2.18.1 | MySQL é©±åŠ¨ | âš ï¸ å®˜æ–¹åœæ­¢ç»´æŠ¤ï¼Œè€ƒè™‘è¿ç§»åˆ° mysql2 | âš ï¸ éœ€è®¡åˆ’è¿ç§» |
| `redis` | ^4.7.0 | Redis å®¢æˆ·ç«¯ | ä¿æŒç¨³å®šç‰ˆæœ¬ | âœ… ç¨³å®š |

**è¿ç§» mysql â†’ mysql2**:

```javascript
// æ—§ä»£ç  (mysql)
const mysql = require('mysql');
const connection = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: '123456',
  database: 'niuniu'
});

// æ–°ä»£ç  (mysql2)
const mysql = require('mysql2/promise');
const connection = await mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: '123456',
  database: 'niuniu'
});

// mysql2 çš„ä¼˜åŠ¿:
// - Promise æ”¯æŒï¼ˆasync/awaitï¼‰
// 2. æ€§èƒ½æå‡ 30%
// - å®˜æ–¹ç§¯æç»´æŠ¤
// - æ”¯æŒè¿æ¥æ± 
```

**è¿ç§»æ­¥éª¤**:
```
ç¬¬1å‘¨: è¯„ä¼°å’Œè®¡åˆ’
  - è¯„ä¼°ç°æœ‰ mysql ä½¿ç”¨æƒ…å†µ
  - è®¾è®¡å…¼å®¹å±‚
  - å‡†å¤‡å›æ»šè®¡åˆ’

ç¬¬2-3å‘¨: å®ç°å…¼å®¹å±‚
  - åˆ›å»ºæ–°é©±åŠ¨å®ä¾‹
  - å®ç°å…¼å®¹æ¥å£
  - æœ¬åœ°å®Œæ•´æµ‹è¯•

ç¬¬4å‘¨: ç°åº¦åˆ‡æ¢
  - 10% æµé‡ä½¿ç”¨ mysql2
  - 24 å°æ—¶ç›‘æ§
  - éªŒè¯æ•°æ®ä¸€è‡´æ€§

ç¬¬5å‘¨: å®Œå…¨åˆ‡æ¢
  - 100% æµé‡è¿ç§»åˆ° mysql2
  - ä¿ç•™å›æ»šèƒ½åŠ›
  - åˆ é™¤æ—§é©±åŠ¨
```

#### å¼‚æ­¥å’Œå·¥å…·åº“

| åŒ… | å½“å‰ç‰ˆæœ¬ | ä½œç”¨ | çŠ¶æ€ |
|----|---------| ----|------|
| `async` | ^3.2.5 | å¼‚æ­¥å·¥å…· | âœ… ç¨³å®šï¼ˆä½†åº”é€æ­¥ä½¿ç”¨åŸç”Ÿ Promiseï¼‰ |
| `lodash` | ^4.17.21 | å·¥å…·å‡½æ•° | âœ… ç¨³å®šï¼ˆä½†åº”é€æ­¥ä½¿ç”¨ ES6 æ–¹æ³•ï¼‰ |
| `nodemailer` | ^6.9.13 | é‚®ä»¶æœåŠ¡ | âœ… ç¨³å®š |

**é•¿æœŸæ›¿ä»£è®¡åˆ’**:
```javascript
// é€æ­¥ä½¿ç”¨ ES6 åŸç”Ÿæ–¹æ³•æ›¿ä»£ lodash

// æ—§ä»£ç 
const _ = require('lodash');
const result = _.map(users, 'name');
const unique = _.uniq(ids);

// æ–°ä»£ç 
const result = users.map(u => u.name);
const unique = [...new Set(ids)];

// å¥½å¤„:
// - å‡å°‘å¤–éƒ¨ä¾èµ–
// - æå‡æ€§èƒ½
// - æ›´æ˜“ç»´æŠ¤
```

#### æ—¥å¿—ç³»ç»Ÿ âš ï¸ **éœ€è¦å‡çº§**

| åŒ… | å½“å‰ç‰ˆæœ¬ | é—®é¢˜ | ç›®æ ‡ç‰ˆæœ¬ | ä¼˜å…ˆçº§ |
|----|---------|------|--------|--------|
| `log4js` | ^1.1.1 | ææ—§ï¼ˆå‘å¸ƒäº 2016 å¹´ï¼‰ï¼Œç¼ºä¹ç»´æŠ¤ | ^6.x | ğŸ”´ é«˜ |

**å‡çº§è®¡åˆ’**:
```bash
# log4js å¤§ç‰ˆæœ¬å‡çº§ (1.x â†’ 6.x)
# é‡å¤§å˜åŒ–ï¼šAPI å®Œå…¨æ”¹å˜ï¼Œé…ç½®æ ¼å¼ä¸åŒ

# ç¬¬1æ­¥: è¯„ä¼°å½±å“
grep -r "log4js" niuniu_server/

# ç¬¬2æ­¥: åœ¨æµ‹è¯•åˆ†æ”¯å‡çº§
npm install log4js@^6.x

# ç¬¬3æ­¥: æ›´æ–°æ‰€æœ‰æ—¥å¿—è°ƒç”¨
# æ—§ API:
const log4js = require('log4js');
const logger = log4js.getLogger();
logger.error("message");

# æ–° API:
const log4js = require('log4js');
log4js.configure({...});
const logger = log4js.getLogger('category');
logger.error("message");

# ç¬¬4æ­¥: å……åˆ†æµ‹è¯•å¹¶å‘å¸ƒ
```

### å¼€å‘ä¾èµ–

è¿™äº›åªåœ¨å¼€å‘å’Œæµ‹è¯•é˜¶æ®µä½¿ç”¨ï¼Œå¯ä»¥æ›´é¢‘ç¹åœ°æ›´æ–°ã€‚

| åŒ… | å½“å‰ç‰ˆæœ¬ | ä½œç”¨ |
|----|---------|------|
| `eslint` | ^9.0.0 | ä»£ç è´¨é‡æ£€æŸ¥ |
| `mocha` | ^10.8.2 | æµ‹è¯•æ¡†æ¶ |
| `chai` | ^4.5.0 | æ–­è¨€åº“ |

---

## ğŸš€ å‡çº§æµç¨‹

### ç¬¬ 1 é˜¶æ®µï¼šæ ¸å¿ƒä¾èµ– (Week 1-2)

ä¼˜å…ˆçº§æœ€é«˜çš„ä¾èµ–ï¼Œå¿…é¡»åœ¨ç¨³å®šæ€§å’Œå®‰å…¨æ€§ä¹‹é—´å¹³è¡¡ã€‚

```yaml
å‡çº§èŒƒå›´:
  - express (patch)
  - ws (patch)
  - redis (ä¿æŒ)

å‡çº§æ­¥éª¤:
  1. åˆ›å»ºå‡çº§åˆ†æ”¯
  2. æ›´æ–°å•ä¸ªä¾èµ–
  3. è¿è¡Œå®Œæ•´æµ‹è¯• (npm test)
  4. è¿è¡Œ npm audit
  5. Lint æ£€æŸ¥
  6. Docker é•œåƒæ„å»º
  7. æäº¤ PRï¼Œè¿›è¡Œä»£ç å®¡æŸ¥
  8. Merge åˆ° main
  9. ç°åº¦éƒ¨ç½² (10% â†’ 100%)
```

### ç¬¬ 2 é˜¶æ®µï¼šæ•°æ®åº“é©±åŠ¨ (Week 3-4)

éœ€è¦æ›´å¤šæ—¶é—´å’Œæµ‹è¯•ï¼Œå› ä¸ºæ¶‰åŠå…³é”®ä¸šåŠ¡é€»è¾‘ã€‚

```yaml
å‡çº§èŒƒå›´:
  - mysql (è¿ç§»åˆ° mysql2)
  - æ•°æ®åº“è¿æ¥ä»£ç 

å‡çº§æ­¥éª¤:
  1. åˆ›å»º migration åˆ†æ”¯
  2. å®‰è£… mysql2
  3. åˆ›å»ºå…¼å®¹å±‚ï¼ˆåŒæ—¶æ”¯æŒä¸¤ä¸ªé©±åŠ¨ï¼‰
  4. ä¿®æ”¹é…ç½®æ–‡ä»¶
  5. æœ¬åœ°æµ‹è¯•ï¼ˆæ‰€æœ‰æ¸¸æˆé€»è¾‘ï¼‰
  6. å‹åŠ›æµ‹è¯•ï¼ˆéªŒè¯æ€§èƒ½ï¼‰
  7. ç°åº¦éƒ¨ç½² (10% â†’ 50% â†’ 100%)
  8. è¿è¡Œ 7 å¤©åå¯åˆ é™¤ mysql
```

### ç¬¬ 3 é˜¶æ®µï¼šå·¥å…·åº“ (Week 5+)

ç›¸å¯¹å®‰å…¨çš„å‡çº§ï¼Œä½†ä»éœ€å…¨é¢æµ‹è¯•ã€‚

```yaml
å‡çº§èŒƒå›´:
  - log4js (1.x â†’ 6.x) - å¤§ç‰ˆæœ¬
  - request â†’ axios è¿ç§»
  - é€æ­¥åˆ é™¤ lodash

æ—¶é—´è¡¨:
  ç¬¬5-6å‘¨: log4js å‡çº§
  ç¬¬7-8å‘¨: request è¿ç§»
  ç¬¬9å‘¨+: lodash æ¶ˆé™¤
```

### å‡çº§æ£€æŸ¥æ¸…å•

```bash
#!/bin/bash
# upgrade-checklist.sh

PACKAGE=$1
VERSION=$2

echo "å‡çº§æ¸…å•: $PACKAGE@$VERSION"
echo ""

# 1. æŸ¥çœ‹åŒ…ä¿¡æ¯
echo "1ï¸âƒ£  æŸ¥çœ‹åŒ…ä¿¡æ¯..."
npm view $PACKAGE@$VERSION | grep -E "^(name|version|description|license|deprecated)"

# 2. æ£€æŸ¥ç ´åæ€§å˜æ›´
echo ""
echo "2ï¸âƒ£  æ£€æŸ¥ç ´åæ€§å˜æ›´..."
npm info $PACKAGE | grep -A 10 "breaking change" || echo "æ— é‡å¤§å˜æ›´å…¬å‘Š"

# 3. æŸ¥çœ‹ CHANGELOG
echo ""
echo "3ï¸âƒ£  æŸ¥çœ‹ CHANGELOG..."
npm info $PACKAGE repository.url | xargs -I {} sh -c 'echo "Repository: {}"'

# 4. å®‰è£…å¹¶æµ‹è¯•
echo ""
echo "4ï¸âƒ£  å®‰è£…æ–°ç‰ˆæœ¬..."
npm install $PACKAGE@$VERSION

echo "5ï¸âƒ£  è¿è¡Œæµ‹è¯•..."
npm test

echo "6ï¸âƒ£  è¿è¡Œ Lint..."
npm run lint

echo "7ï¸âƒ£  æ„å»º Docker..."
docker build -t test:upgrade .

echo ""
echo "âœ… æ£€æŸ¥å®Œæˆ"
```

---

## ğŸ”’ å®‰å…¨æ‰«æ

### npm audit å·¥ä½œæµ

```bash
# 1. å®šæœŸæ‰«æ
npm audit --production

# 2. è‡ªåŠ¨ä¿®å¤
npm audit fix

# 3. å‡çº§ç‰¹å®šåŒ…
npm audit fix --depth=3 lodash

# 4. ç”ŸæˆæŠ¥å‘Š
npm audit --json > audit-report.json

# 5. æ£€æŸ¥ä¸¥é‡æ¼æ´
npm audit --json | jq '.vulnerabilities | to_entries[] | select(.value.severity=="critical")'
```

### CI/CD å®‰å…¨æ£€æŸ¥

é¡¹ç›®é…ç½®äº†è‡ªåŠ¨åŒ–å®‰å…¨æ‰«æå·¥ä½œæµ (`.github/workflows/security-scan.yml`)ï¼š

- âœ… **npm audit** - æ£€æŸ¥ä¾èµ–æ¼æ´
- âœ… **Snyk** - æ·±åº¦å®‰å…¨åˆ†æ
- âœ… **Docker é•œåƒæ‰«æ** - Trivy é•œåƒå®‰å…¨æ£€æŸ¥
- âœ… **ESLint** - ä»£ç è´¨é‡æ£€æŸ¥

**è§¦å‘æ—¶æœº**:
- æ¯æ¬¡ push åˆ° main/develop/master
- æ¯æ¬¡ pull request
- æ¯å¤©å‡Œæ™¨ 2 ç‚¹å®šæ—¶æ‰«æ

### å¤„ç†æ¼æ´

```yaml
ä¸¥é‡ (Critical):
  è¡ŒåŠ¨: ç«‹å³ä¿®å¤ï¼ˆåŒå¤©ï¼‰
  æ­¥éª¤:
    1. npm audit fix
    2. æ‰‹åŠ¨æµ‹è¯•å…³é”®åŠŸèƒ½
    3. ç«‹å³éƒ¨ç½²
    4. ç›‘æ§å‘Šè­¦

é«˜å± (High):
  è¡ŒåŠ¨: å°½å¿«ä¿®å¤ï¼ˆ3 å¤©å†…ï¼‰
  æ­¥éª¤:
    1. npm audit fix --depth=3
    2. å®Œæ•´æµ‹è¯•
    3. ç°åº¦éƒ¨ç½²
    4. ç›‘æ§æ€§èƒ½

ä¸­ç­‰ (Moderate):
  è¡ŒåŠ¨: ä¸‹æ¬¡å‘å¸ƒæ—¶ä¿®å¤
  æ­¥éª¤:
    1. è®°å½•åœ¨æ¡ˆ
    2. åœ¨å¸¸è§„æ›´æ–°å‘¨æœŸä¿®å¤
    3. éç´§æ€¥æƒ…å†µ

ä½ (Low):
  è¡ŒåŠ¨: é•¿æœŸè®¡åˆ’ä¿®å¤
  æ­¥éª¤:
    1. è®°å½•åœ¨æ¡ˆ
    2. ä¸å…¶ä»–æ›´æ–°ä¸€èµ·å¤„ç†
```

---

## ğŸ—„ï¸ æ•°æ®åº“å…¼å®¹æ€§

### ç‰ˆæœ¬å‡çº§çš„æ•°æ®åº“è€ƒé‡

å½“å‡çº§ä¾èµ–æ—¶ï¼Œå¿…é¡»ç¡®ä¿æ–°æ—§ç‰ˆæœ¬çš„æ•°æ®åº“é©±åŠ¨å…¼å®¹æ€§ã€‚

#### mysql â†’ mysql2 è¿ç§»æ—¶çš„æ•°æ®åº“å…¼å®¹æ€§

```sql
-- ç¡®ä¿æ•°æ®åº“ä¸º MySQL 5.7+ æˆ– 8.0+
SELECT VERSION();  -- æ£€æŸ¥ MySQL ç‰ˆæœ¬

-- éªŒè¯å­—ç¬¦é›†
SHOW VARIABLES LIKE 'character_set%';

-- æ£€æŸ¥å­˜å‚¨å¼•æ“
SHOW TABLE STATUS FROM niuniu\G

-- éªŒè¯çº¦æŸ
SELECT * FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE 
WHERE TABLE_SCHEMA = 'niuniu';
```

#### åŒå†™éªŒè¯ï¼ˆè¿ç§»æ—¶ï¼‰

```javascript
// åŒæ—¶å†™å…¥ä¸¤ä¸ªé©±åŠ¨ï¼Œè¯»å–æ–°é©±åŠ¨
// ç”¨äºéªŒè¯æ•°æ®ä¸€è‡´æ€§

async function dualWrite(user) {
    // å†™å…¥æ—§é©±åŠ¨
    await mysql_v1.query('INSERT INTO users SET ?', user);
    
    // å†™å…¥æ–°é©±åŠ¨
    await mysql2_v1.query('INSERT INTO users SET ?', user);
    
    // è¯»å–æ–°é©±åŠ¨éªŒè¯
    const result = await mysql2_v1.query('SELECT * FROM users WHERE id = ?', [user.id]);
    return result[0];
}
```

#### å›æ»šæ•°æ®åº“ç‰ˆæœ¬

```bash
#!/bin/bash
# rollback-database.sh

# æ¢å¤æ—§ç‰ˆæœ¬æ•°æ®åº“
mysqldump -u root niuniu > backup-new.sql
mysql -u root niuniu < backup-old.sql

# éªŒè¯æ¢å¤
mysql -u root niuniu -e "SELECT COUNT(*) FROM users;"
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### Q1: npm install å¤±è´¥

```bash
# æ¸…ç©ºç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules å’Œ lock æ–‡ä»¶
rm -rf node_modules package-lock.json

# é‡æ–°å®‰è£…
npm install

# å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œæ£€æŸ¥ engines
npm ls --engines
```

#### Q2: å‡çº§ååº”ç”¨å¯åŠ¨å¤±è´¥

```bash
# 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
npm start 2>&1 | head -50

# 2. å›æ»šä¾èµ–
npm install <package>@<old-version>

# 3. è¿è¡Œæµ‹è¯•
npm test

# 4. æ£€æŸ¥ API å˜åŒ–
# æŸ¥çœ‹åŒ…çš„ CHANGELOG ä¸­çš„ Breaking Changes
```

#### Q3: npm audit æŠ¥å‘Šè¿‡å¤šæ¼æ´

```bash
# 1. åˆ†ç±»æ¼æ´
npm audit --json | jq '.vulnerabilities | 
  group_by(.severity) | 
  map({severity: .[0].severity, count: length})'

# 2. åªä¿®å¤å¯ä¿®å¤çš„
npm audit fix

# 3. å¯¹äºæ— æ³•ä¿®å¤çš„ï¼Œè¯„ä¼°é£é™©
# - æ˜¯å¦çœŸæ­£å½±å“ç”Ÿäº§ä»£ç ï¼Ÿ
# - æ˜¯å¦æ˜¯å¼€å‘ä¾èµ–ï¼Ÿ
# - æ˜¯å¦æœ‰æ›¿ä»£æ–¹æ¡ˆï¼Ÿ

# 4. ç”Ÿæˆå®¡è®¡è±å…æ¸…å•
cat > .auditignore << EOF
# è±å…åˆ—è¡¨
1234567  # åŒ… A çš„å·²çŸ¥é—®é¢˜ï¼ˆè¯„ä¼°åè®¤ä¸ºä½é£é™©ï¼‰
EOF
```

#### Q4: Docker é•œåƒæ„å»ºæ—¶ä¾èµ–å†²çª

```bash
# 1. æ£€æŸ¥ Dockerfile ä¸­çš„ npm ci
# ä½¿ç”¨ npm ci è€Œä¸æ˜¯ npm install

# 2. æ£€æŸ¥ .dockerignore
# ç¡®ä¿æ²¡æœ‰æ’é™¤ package-lock.json

# 3. æ¸…ç©º Docker æ„å»ºç¼“å­˜
docker build --no-cache -t niuniu:latest .

# 4. æ£€æŸ¥ engines
npm ls --engines
```

---

## ğŸ“Š ä¾èµ–ç®¡ç†è„šæœ¬

é¡¹ç›®æä¾›äº†è‡ªåŠ¨åŒ–è„šæœ¬ `niuniu_server/dependency-manager.sh`ï¼š

```bash
# è¿è¡Œå®‰å…¨å®¡è®¡
./dependency-manager.sh audit

# æ£€æŸ¥è¿‡æ—¶çš„åŒ…
./dependency-manager.sh check

# å‡çº§æŒ‡å®šçš„åŒ…
./dependency-manager.sh upgrade express latest

# è‡ªåŠ¨ä¿®å¤æ¼æ´
./dependency-manager.sh fix

# éªŒè¯ engines å­—æ®µ
./dependency-manager.sh engines

# ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
./dependency-manager.sh report
```

---

## ğŸ“ æœ€ä½³å®è·µ

### âœ… åº”è¯¥åš

- âœ… å®šæœŸè¿è¡Œ `npm audit`
- âœ… ä½¿ç”¨ `npm ci` æ›¿ä»£ `npm install`ï¼ˆCI/CD ç¯å¢ƒï¼‰
- âœ… æäº¤ `package-lock.json`ï¼ˆç¡®ä¿ç‰ˆæœ¬ä¸€è‡´æ€§ï¼‰
- âœ… ä¸ºé‡å¤§ç‰ˆæœ¬å‡çº§åˆ›å»ºä¸“é—¨çš„ PR
- âœ… åœ¨å‡çº§å‰å¤‡ä»½ `package-lock.json`
- âœ… æ›´æ–°åè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- âœ… ç°åº¦éƒ¨ç½²æ–°ç‰ˆæœ¬ä¾èµ–

### âŒ ä¸åº”è¯¥åš

- âŒ å¿½è§† npm audit çš„å®‰å…¨è­¦å‘Š
- âŒ ä¸€æ¬¡æ€§å‡çº§æ‰€æœ‰ä¾èµ–
- âŒ åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥è¿è¡Œ `npm install`
- âŒ å¿½è§† `package-lock.json` çš„ç‰ˆæœ¬å†²çª
- âŒ è·³è¿‡æµ‹è¯•ç›´æ¥éƒ¨ç½²
- âŒ åˆ é™¤æ—§ç‰ˆæœ¬é•œåƒï¼ˆä¿ç•™ç”¨äºå›æ»šï¼‰

---

## ğŸ“ æ”¯æŒ

**å…³é”®è”ç³»æ–¹å¼**:
- ä¾èµ–å‡çº§é—®é¢˜: åç«¯å›¢é˜Ÿä¸»ç¨‹
- å®‰å…¨æ¼æ´: ä¿¡æ¯å®‰å…¨å›¢é˜Ÿ
- æ•°æ®åº“è¿ç§»: DBA å›¢é˜Ÿ

**æ–‡æ¡£ç»´æŠ¤**:
- ä½œè€…: DevOps Team
- æœ€åæ›´æ–°: 2025å¹´11æœˆ17æ—¥
- ä¸‹æ¬¡è¯„å®¡: 2025å¹´12æœˆ17æ—¥

---

**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… å®Œæˆ  
**æœ€åç¼–è¾‘**: 2025å¹´11æœˆ17æ—¥
